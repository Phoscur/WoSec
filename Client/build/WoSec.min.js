var WoSec={};if(typeof Object.create!=="function"){Object.create=function(b){function a(){}a.prototype=b;return new a()}}if(typeof Array.prototype.forEach!=="function"){Array.prototype.forEach=function(d){var a=this.length;if(typeof d!="function"){throw new TypeError()}var b=arguments[1];for(var c=0;c<a;c++){if(c in this){d.call(b,this[c],c,this)}}}}if(typeof Function.prototype.bind!=="function"){Function.prototype.bind=(function(a){function b(e){var d=this;if(1<arguments.length){var c=a.call(arguments,1);return function(){return d.apply(e,arguments.length?c.concat(a.call(arguments)):c)}}return function(){return arguments.length?d.apply(e,arguments):d.call(e)}}return b}(Array.prototype.slice))}WoSec.baseObject={later:function(c,d){var b=this,a=Array.prototype.slice.apply(arguments,[2]);if(typeof d==="string"){d=b[d]}setTimeout(function(){d.apply(b,a)},c);return b}};WoSec.inherit=function(b,c){var a=Object.create(c.prototype);a.constructor=b;b.prototype=a};WoSec.svgUtility=(function(){var a="color-store",j="rect-unobtrusive",i="rect-obtrusive",k="rect-reset";var e="media/images/fileicon.png",f={width:25.5,height:33};var g=jQuery;var h;function l(){if(!h){h=document.createElementNS("http://www.w3.org/2000/svg","image");h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e);h.setAttribute("width",f.width);h.setAttribute("height",f.height)}return h}function d(m){return g("svg rect").filter(function(){return g(this).attr("bpmn:activity-id")==m})}function c(m){return g("svg circle").filter(function(){return g(this).attr("bpmn:activity-id")==m})}function b(m){return g("svg rect").filter(function(){return g(this).attr("bpmn:pool-id")==m})}return{getTaskRectangle:function(m){var o=d(m);if(o.length==0){o=c(m)}if(o.length==0){throw new Error("No rectangles/circles with activityID:["+m+"] found")}var p=Object.create(WoSec.baseObject);p.getPosition=function(){return{x:parseInt(g(o[0]).attr("x")),y:parseInt(g(o[0]).attr("y")),width:parseInt(g(o[0]).attr("width")),height:parseInt(g(o[0]).attr("height")),getCenter:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}};var r=g("svg text").filter(function(){var s=p.getPosition();return Math.abs(parseInt(g(this).attr("x"))-s.x)<s.width&&Math.abs(parseInt(g(this).attr("y"))-s.y)<s.height});function n(s){s.x-=f.width/2;s.y-=f.height/2;return s}var q=this.createAnimation(m,n(p.getPosition().getCenter()));p.showAnimation=function(s){q.show(n(s.getPosition().getCenter()));return this};p.highlight=function(){o.each(function(){g(this).effect("pulsate",{times:3},1000)});return this};p.markObtrusive=function(){o.each(function(){g(this).attr("fill",g("#"+i).css("color"))});return this};p.markUnobtrusive=function(){o.each(function(){g(this).attr("fill",g("#"+j).css("color"))});return this};p.reset=function(){o.each(function(){g(this).attr("fill",g("#"+k).css("color"))});return this};p.registerOnClick=function(s){g(o[0]).click(s);r.each(function(){g(this).click(s)});return this};p.registerOnHover=function(s){g(o[0]).hover(s);r.each(function(){g(this).hover(s)});return this};return p},createAnimation:function(q,m){var o=Object.create(WoSec.baseObject);var n=l().cloneNode(true);n.setAttribute("id",q);g("svg")[0].appendChild(n);var p=g("#"+q);p.hide();p.attr("x",m.x);p.attr("y",m.y);o.show=function(r){p.show();p.animate({svgY:r.y},2000,function(){p.hide();p.attr("y",m.y)});return this};return o},getTaskLaneRectangle:function(n){var m=b(n);var o=Object.create(WoSec.baseObject);o.highlight=function(){m.each(function(){g(this).effect("pulsate",{times:1},1000)})};return o}}}());WoSec.htmlRenderer=(function(){var h=jQuery;const f="infoboxes",v="infobox",k="infobox-participant",b="infobox-data",u=3000;const o="databox",z="databox-entry",d="databox-hover",a=5000;const c="timeslider",x="timeslider-entry",m="timeslider-play-button",g="timeslider-play-button-overlay";var j;function y(){if(!j){j=h('<div class="'+v+'"><div class="'+k+'"></div><div class="'+b+'"></div></div>').hide()}return j}var l=false;function n(){l=true;var C=false;var B=false;var D=parseInt(h("#"+o).css("left"));var E=h("#"+o);h("#"+d).hover(function(){if(!C&&!B){C=true;E.animate({left:-10}).css("opacity",0.8);setTimeout(function(){if(!B){E.animate({left:D},function(){C=false})}},a)}return false});E.click(function(){if(C&&!B){B=true}else{if(B){B=false;h(this).animate({left:D},"slow",function(){C=false})}}return false})}var t;function e(){if(!t){t=h('<div class="'+z+'"></div>')}return t}var w=[];var i={add:function(C){if(!l){n()}if(C&&w.indexOf(C)==-1){var B=e().clone().appendTo("#"+o);B.text(C);w.push(C);h("#"+o).effect("pulsate",{times:3})}}};var r;function s(){if(!r){r=h('<a class="'+x+'"></a>')}return r}var A;var q=[];var p;return{timeSlider:{init:function(){p=WoSec.eventChain;p.registerObserver(this);h("#"+m).click(function(){p.unlock().play()});A=h("#"+c).slider({slide:function(D,F){var E=A.slider("option","value");var C=F.value<E;var B;q.forEach(function(G){if(G.timestamp<=F.value){B=G.eventCommand}});p.lock().seek(function(G){if(!C){G.execute()}else{G.unwind()}if(G==B){return false}},C)}});return this},adjustSize:function(){var F;var D;var E=A.slider("option","min");var B=A.slider("option","max");var G=false;p.forEach(function(K,H){if(!q[H]){var I={};I.eventCommand=K;I.timestamp=K.getTimestamp();I.entry=s().clone().appendTo("#"+c);I.entry.addClass("timeslider-entry-"+K.getClass());q.push(I)}var J=K.getTimestamp();if(!F||J<F){F=J}if(!D||J>D){D=J}if(F){A.slider("option","min",F);G=true}if(D){A.slider("option","max",D);G=true}});if(F==E&&D==B){G=false}if(G){var C=D-F;q.forEach(function(H){rightPercent=(D-H.timestamp)/C*100;H.entry.css("left",(100-rightPercent)+"%")})}return this},notify:function(){if(p.getLength()!=q.length){this.adjustSize();if(p.isLocked()){h("#"+g).show();h("#"+m).effect("pulsate",{times:10},1000);setTimeout(function(){h("#"+g).hide()},10000)}}A.slider("option","value",p.getEventCommand(p.getCurrentPosition()).getTimestamp());return this}},createInfobox:function(){var B=y().clone().appendTo("#"+f);var E=true;function D(F){B.find("."+k).text(F)}function C(F){B.find("."+b).text(F)}return{bindToSVGRectangle:function(H){var G=H.getPosition();B.css("top",G.y+G.height);B.css("left",G.x+G.width);var J=false;var F=false;var I=function(){if(!J){J=true}else{B.slideToggle("slow");J=false}return false};var K=function(){if(!J&&!F&&!E){F=true;B.slideToggle("slow");setTimeout(function(){if(!J){B.slideToggle("slow")}F=false},u)}return false};H.registerOnHover(K);B.click(I);return this},show:function(){B.show();return this},hide:function(){B.hide();return this},setContent:function(F){if(F.participant&&F.participant!=""){D(F.participant);E=false}if(F.data&&F.data!=""){C(F.data);i.add(F.data);E=false}return this}}}}}());(function(){function a(b,c,e){var d=Object.create(WoSec.baseObject);b.bindToSVGRectangle(c);d.showInfobox=b.show;d.hideInfobox=b.hide;d.getCorrespondingTask=function(){return typeof(e)=="string"&&e!=""&&WoSec.workflow.getTaskByID(e)};d.highlight=c.highlight;d.setInformation=b.setContent;d.getPosition=c.getPosition;d.animateData=function(){this.getCorrespondingTask()&&c.showAnimation(this.getCorrespondingTask());return this};d.markActive=c.markObtrusive;d.markFinished=c.markUnobtrusive;d.reset=c.reset;return d}WoSec.newTask=a}());(function(){function a(c,b){var e=Object.create(WoSec.baseObject);var d=function(){var f=[];b.forEach(function(g,h){f[h]=WoSec.workflow.getTaskByID(g)});return f};e.highlight=c.highlight;e.setInformation=function(f){d().forEach(function(g){g.setInformation(f)});return this};return e}WoSec.newTaskLane=a}());WoSec.workflow=(function(){var e=WoSec.newTask;var b=WoSec.newTaskLane;var g=WoSec.htmlRenderer;var d=WoSec.svgUtility;var a;var k={};var h={};var j={};var i={};function f(l){if(typeof(l)!="string"){throw new TypeError("The given ID is not a String")}return e(g.createInfobox(),d.getTaskRectangle(l),j[l])}function c(l){if(typeof(l)!="string"){throw new TypeError("The given groupID is not a String")}if(!i[l]){throw new Error("Unknown activityGroupID")}return b(d.getTaskLaneRectangle(l),i[l])}return{init:function(m,n,l){a=m;j=n;i=l},getInstanceID:function(){return a},getTaskByID:function(l){if(!k[l]){k[l]=f(l)}return k[l]},getTaskLaneByID:function(l){if(!h[l]){h[l]=c(l)}return h[l]}}}());(function(){var g=WoSec.workflow;function f(h){if(typeof(h)!="number"){throw new Error("Timestamp ["+h+"] is not a number")}this.timestamp=h}f.prototype=Object.create(WoSec.baseObject);f.prototype.classname="EventCommand";f.prototype.getClass=function(){return this.classname};f.prototype.execute=function(){return this};f.prototype.animate=function(){return this};f.prototype.unwind=function(){return this};f.prototype.getTimestamp=function(){return this.timestamp};f.create=function(h){return new f(h.timestamp)};function b(){}WoSec.inherit(b,f);function a(h,i){f.call(this,i);this.task=h}WoSec.inherit(a,b);a.prototype.classname="HighlightingEvent";a.prototype.execute=function(){this.task.markActive();this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().markActive();return this};a.prototype.unwind=function(){this.task.reset();this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().reset();return this};a.prototype.animate=function(){this.task.highlight();this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().highlight();return this};a.create=function(h){return new a(g.getTaskByID(h.activityID),h.timestamp)};function e(h,i,j){f.call(this,j);this.task=h;this.information=i||{}}WoSec.inherit(e,b);e.prototype.classname="MarkFinishedEvent";e.prototype.execute=function(){this.task.markFinished();this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().markFinished();this.task.setInformation(this.information);this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setInformation(this.information);return this};e.prototype.unwind=function(){this.task.markActive();this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().markActive();return this};e.create=function(h){return new e(g.getTaskByID(h.activityID),h.information,h.timestamp)};function c(h,i,j){f.call(this,j);this.task=h;this.information=i||{}}WoSec.inherit(c,f);c.prototype.classname="TransferingDataEvent";c.prototype.execute=function(){this.task.setInformation(this.information);return this};c.prototype.animate=function(){this.task.animateData();return this};c.create=function(h){return new c(g.getTaskByID(h.activityID),h.information,h.timestamp)};function d(j,h,i){f.call(this,i);this.taskLane=j;this.information=h||{}}WoSec.inherit(d,f);d.prototype.classname="SpecifyingParticipantEvent";d.prototype.execute=function(){this.taskLane.setInformation(this.information);return this};d.prototype.animate=function(){this.taskLane.highlight();return this};d.create=function(h){return new d(g.getTaskLaneByID(h.activityGroupID),h.information,h.timestamp)};f.EventCommand=f;f.StateChanging=b;f.Highlighting=a;f.MarkFinished=e;f.TransferingData=c;f.SpecifyingParticipant=d;WoSec.EventCommand=f}());WoSec.eventChain=(function(){const a=750;var e=WoSec.EventCommand;var c=[];var d=0;var f=[];var b=false;return{registerObserver:function(g){if(typeof g.notify!=="function"){throw new Error("Observer has to support notify()-Method")}f.push(g);return this},getCurrentPosition:function(){return d},getEventCommand:function(g){return c[g]},getLength:function(){return c.length},lock:function(){b=true;return this},unlock:function(){b=false;return this},isLocked:function(){return b},add:function(g){g=g||[];g.forEach(function(h){if(!e[h.eventCommand]){throw new Error("Unknown EventCommand: "+h.eventCommand)}c.push(e[h.eventCommand].create(h))});f.forEach(function(h){h.notify()});return this},seek:function(k,g){var j=g?-1:1;var h=d;if(h==c.length){h--}while(0<=h&&h<c.length){d=h;if(k(c[h],h)===false){break}h+=j}f.forEach(function(i){i.notify()});return this},forEach:c.forEach.bind(c),play:function(){if(b){return this}var g=0;this.seek(function(h){h.later(g,"execute").later(g,"animate");g+=a});setTimeout(function(){d=c.length},g);return this},last:function(){if(c[c.length-1]){return c[c.length-1]}else{return new e(0)}}}}());WoSec.ajaxUpdater=(function(){const d=5000,a="UpdateController?type=Event";var c=jQuery;var b=WoSec.eventChain;var e=WoSec.workflow;return{init:function(f){var h=0;f=f||0;function g(j){c.getJSON(a,{since:b.last().getTimestamp()+1,instance:e.getInstanceID()},j)}g(function(j){if(j.length!=0){b.add(j).seek(function(k){return k.getTimestamp()<=f&&k.execute()}).play()}});var i=function(j){if(j.length!=0){b.add(j).play()}setTimeout(g,d,i)};setTimeout(g,d,i);c("body").ajaxError(function(){h++;if(h>=3){alert("Verbindung zum Server verloren!")}else{setTimeout(g,d,i)}})}}}());