var WoSec={baseObject:{later:function(b,f){var c=this,j=Array.prototype.slice.apply(arguments,[2]);typeof f==="string"&&(f=c[f]);setTimeout(function(){f.apply(c,j)},b);return c}},inherit:function(b,f){var c=Object.create(f.prototype);c.constructor=b;b.prototype=c},extend:function(b,f){for(var c in f)f.hasOwnProperty(c)&&(b[c]=f[c]);return b}};(function(){var b=jQuery;WoSec.SVG=function(f){this.$svg=b("#"+f)}})();
(function(){function b(b,h){return b.find("svg rect").filter(function(){return c(this).attr(j)==h})}function f(b,h){return b.find("svg circle").filter(function(){return c(this).attr(j)==h})}var c=jQuery,j="bpmn:activity-id",i={};WoSec.SVG.prototype.getTaskRectangle=function(b){i[b]||(i[b]=this.newTaskRectangle(b));return i[b]};WoSec.SVG.prototype.newTaskRectangle=function(g){var h=this.$svg,a=!1,e=b(h,g);e.length||(e=f(h,g),a=!0);if(e.length==0)throw Error("No rectangles/circles with activityID:["+
g+"] found");var d=Object.create(WoSec.baseObject),l=!0;d.disableAnimations=function(){l=!1;return this};d.enableAnimations=function(){l=!0;return this};d.scrollTo=function(){var a=this.getPosition(),b=a.x-h.parent().width()/2,a=a.y-h.parent().height()/2,c=h.scrollLeft(),e=h.scrollTop();if(Math.abs(b-c)>100||Math.abs(a-e)>100)h.animate({scrollLeft:b},100),h.animate({scrollTop:a},100);return this};d.refresh=function(a){switch(a.getState()){case "Reset":this.reset();break;case "Started":this.markObtrusive();
this.scrollTo();l&&this.highlight();break;case "Finished":this.markUnobtrusive(),this.scrollTo()}};d.getPosition=function(){if(a){var b=parseInt(c(e[0]).attr("r"));return{x:parseInt(c(e[0]).attr("cx")),y:parseInt(c(e[0]).attr("cy")),width:b*2,height:b*2,getCenter:function(){return{x:this.x,y:this.y}}}}return{x:parseInt(c(e[0]).attr("x")),y:parseInt(c(e[0]).attr("y")),width:parseInt(c(e[0]).attr("width")),height:parseInt(c(e[0]).attr("height")),getCenter:function(){return{x:this.x+this.width/2,y:this.y+
this.height/2}}}};var k=h.find("svg text").filter(function(){var a=d.getPosition();return Math.abs(parseInt(c(this).attr("x"))-a.x)<a.width&&Math.abs(parseInt(c(this).attr("y"))-a.y)<a.height});d.highlight=function(){e.each(function(){c(this).effect("pulsate",{times:3},1E3)});return this};d.markObtrusive=function(){e.each(function(){var a=c("#rect-obtrusive").css("color");c(this).attr("fill",a);c(this).css("fill",a)});return this};d.markUnobtrusive=function(){e.each(function(){var a=c("#rect-unobtrusive").css("color");
c(this).attr("fill",a);c(this).css("fill",a)});return this};d.reset=function(){e.each(function(){var a=c("#rect-reset").css("color");c(this).attr("fill",a);c(this).css("fill",a)});return this};d.registerOnClick=function(a){c(e[0]).click(a);k.each(function(){c(this).click(a)});return this};d.registerOnHover=function(a){c(e[0]).hover(a);k.each(function(){c(this).hover(a)});return this};d.getOtherWorkflowID=function(){var a;e.each(function(){var b=c(this).attr("bpmn:other-workflow");b&&(a=b)});return a};
return d}})();(function(){function b(b,j){return b.find("svg rect").filter(function(){return f(this).attr("bpmn:pool-id")==j})}var f=jQuery;WoSec.SVG.prototype.newTaskLaneRectangle=function(c){var j=b(this.$svg,c),c=Object.create(WoSec.baseObject),i=!0;c.disableAnimations=function(){i=!1;return this};c.enableAnimations=function(){i=!0;return this};c.highlight=function(){j.each(function(){f(this).effect("pulsate",{times:1},1E3)})};c.refresh=function(){i&&this.highlight()};return c}})();
(function(){var b,f,c=jQuery;b=25.5;f=33;var j;WoSec.SVG.prototype.newDataAnimation=function(i,g,h){function a(a){a.x-=b/2;a.y-=f/2;return a}var g=a(g),h=a(h),e=Object.create(WoSec.baseObject),d=this.$svg;j||(j=document.createElementNS("http://www.w3.org/2000/svg","image"),j.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","media/images/fileicon.png"),j.setAttribute("width",b),j.setAttribute("height",f));var l=j.cloneNode(!0);l.setAttribute("id",i);d.find("svg")[0].appendChild(l);var k=
c("#"+i);k.hide();k.attr("x",g.x);k.attr("y",g.y);var o=!0;e.disableAnimations=function(){o=!1;return this};e.enableAnimations=function(){o=!0;return this};e.show=function(){k.show();k.animate({svgY:h.y},1E3,function(){k.hide();k.attr("y",g.y)});return this};e.refresh=function(a){switch(a.getState()){case "TransferingData":o&&this.show()}};return e}})();
(function(){var b=jQuery,f=WoSec.SVG,c="infoboxes",j="svg",i="workflow-link",g="current-workflow",h=2E3;WoSec.HTMLGUI=function(a){function e(c){b("."+j).each(function(){b(this).hide()});p[r].hide();p[c].show();r=c;b("."+i).each(function(){b(this).removeClass(g);b(this).attr("href").substr(1)===c&&b(this).addClass(g)});b("#"+c).show();s[c].addClass(g);a.forEach(function(a){a.getWorkflow().getID()!==c&&a.lock()})}function d(a){for(var d=a.getID(),f=a.getTaskRepositoryEntries(),g,j=f.length-1;j>=0;j--)if(g=
f[j],!(m[d].indexOf(g)>-1)){var i=a.getTaskByID(g),p=k[d].newTaskRectangle(g);i.registerObserver(p);var q=p.getOtherWorkflowID();q&&i.registerObserver(function(a){return{refresh:function(b){b.getState()==="TransferingData"&&setTimeout(function(){e(a)},h)}}}(q));var n;i.getCorrespondingTask()&&(n=k[d].newDataAnimation(g,p.getPosition().getCenter(),k[d].getTaskRectangle(i.getCorrespondingTask().getID()).getPosition().getCenter()),i.registerObserver(n));g=l.newInfobox(p.getPosition());i.registerObserver(g);
p.registerOnHover(g.show);g.appendTo(b("#"+d).find("."+c));o[d].push(p);n&&o[d].push(n)}m[d]=f}var l=this,k={},o={},m={},n={},p={},q=[],r=a[0].getWorkflow().getID();this.refresh=function(a){d(a);for(var b=a.getID(),c=a.getTaskLaneRepositoryEntries(),e,h=c.length-1;h>=0;h--)if(e=c[h],!(n[b].indexOf(e)>-1)){var f=k[b].newTaskLaneRectangle(e);a.getTaskLaneByID(e).registerObserver(f);o[b].push(f)}n[b]=c;return this};a.forEach(function(a){var b=a.getWorkflow(),c=b.getID();q.push(c);p[c]=new l.TimeSlider(l,
a);p[c].appendTo("#slider");a.registerObserver(p[c]);b.registerObserver(l)});b("."+j).each(function(){var a=b(this).attr("id");if(q.indexOf(a)===-1)throw Error("Unknown workflowID["+a+"]");k[a]=new f(a);o[a]=[];m[a]=[];n[a]=[]});var s={};b("."+i).each(function(){var a=b(this).attr("href").substr(1);s[a]=b(this);if(q.indexOf(a)===-1)throw Error("Unknown workflowID["+a+"]");b(this).click(function(){e(b(this).attr("href").substr(1))})});e(a[0].getWorkflow().getID());this.disableAnimations=function(a){o[a.getWorkflow().getID()].forEach(function(a){a.disableAnimations()});
return this};this.enableAnimations=function(a){o[a.getWorkflow().getID()].forEach(function(a){a.enableAnimations()});return this};b("."+j).dragscrollable({dragSelector:".dragger:first",acceptPropagatedEvent:!0})}})();
(function(){var b=jQuery,f,c,j;WoSec.HTMLGUI.prototype.newInfobox=function(i){f||(f=b("<div class=\"infobox\"><span class='infobox-pin-button'>#</span></div>").hide());var g=f.clone(),h=!0;g.css("top",i.y+i.height);g.css("left",i.x+i.width);var a=!1,e=!1;g.find(".infobox-pin-button").click(function(){e?d.unpin():d.pin()});var d=Object.create(WoSec.baseObject);return WoSec.extend(d,{refresh:function(a){this.setContent(a.getInformation(),a)},show:function(){!a&&!h&&(g.slideToggle("slow"),a=!0,d.later(3E3,
"hide"));return this},hide:function(){a&&!e&&(g.slideToggle("slow"),a=!1);return this},pin:function(){e=!0;d.show();return this},unpin:function(){e=!1;d.hide();return this},setContent:function(a,e){g.find(".infobox-entry").remove();a.forEach(function(a){c||(c=b('<div class="infobox-entry"><span class="infobox-entry-header"><span class="infobox-entry-time"></span><span class="infobox-entry-execUser"></span></span><div class="infobox-entry-content"><span class="infobox-entry-evokUser"></span><span class="infobox-entry-provider"></span><span class="infobox-entry-data"></span><ul class="infobox-entry-attachments"></ul><span class="infobox-entry-usageReason"></span></div></div>'));
var d=c.clone(),f=new Date(a.timestamp*1E3);d.find(".infobox-entry-time").text(f.getDate()+"."+f.getMonth()+"."+f.getFullYear());a.participants&&(d.find(".infobox-entry-execUser").text(a.participants.execUser),d.find(".infobox-entry-evokUser").text(a.participants.evokUser),d.find(".infobox-entry-provider").text(a.participants.provider),h=!1);d.find(".infobox-entry-data").text(a.data);if(a.attachments){var i=d.find(".infobox-entry-attachments");a.attachments.forEach(function(a){j||(j=b('<li class="infobox-attachment-entry"><span class="infobox-attachment-entry-name"></span><a></a></li>'));
var c=j.clone();c.find(".infobox-attachment-entry-name").text(a.name);c.find("a").attr("href",a.link).text(a.type);i.append(c)});h=!1}d.find(".infobox-entry-usageReason").text(a.usageReason);a.fromTask===e.getID()&&a.fromWorkflow===e.getWorkflow().getID()?d.addClass("infobox-entry-outgoing"):d.addClass("infobox-entry-incoming");g.append(d)});return this},registerOnClick:function(a){g.click(a);return this},registerOnHover:function(a,b){g.hover(a,b);return this},appendTo:function(a){g.appendTo(a);return this}})}})();
(function(){var b=jQuery,f="timeslider-play-pause-button",c="timeslider-play-button",j="timeslider-pause-button",i,g;WoSec.HTMLGUI.prototype.TimeSlider=function(h,a){function e(){k=!0;m.find("."+f).removeClass(j).addClass(c)}function d(){var b=a.getLength()>0?a.getEventCommand(0).getTimestamp():0,c=a.last().getTimestamp();n("option","min",b);n("option","max",c);var e=c-b;l.forEach(function(a){rightPercent=(c-a.timestamp)/e*100;a.entry.css("left",100-rightPercent+"%")})}var l=[],k=!1,o=!1;i||(i=b("<div class='timeslider'></div>"));
var m=i.clone(),n=m.slider({slide:function(b,c){var d=n("option","value"),f=c.value<d,g;l.forEach(function(a){if(a.timestamp<=c.value)g=a.eventCommand});h.disableAnimations(a);e();o=!0;a.lock().seek(function(a){f?a.unwind():a.execute();if(a==g)return!1},f);o=!1}}),n=n.slider.bind(n);b("."+f).click(function(){k?(h.enableAnimations(a),k=!1,m.find("."+f).removeClass(c).addClass(j),a.unlock().play()):(a.lock(),e())});b(".timeslider-forward-button").click(function(){h.disableAnimations(a);a.seek(function(a){a.execute()});
k||h.enableAnimations(a)});b(".timeslider-backward-button").click(function(){h.disableAnimations(a);a.seek(function(a){a.execute()},!0);k||h.enableAnimations(a)});this.refresh=function(a,c){switch(c){case "add":a.forEach(function(a,c){if(!l[c]){var e={};e.eventCommand=a;e.timestamp=a.getTimestamp();var d=m;g||(g=b('<a class="timeslider-entry"></a>'));e.entry=g.clone().appendTo(d);e.entry.addClass("timeslider-entry-"+a.getClass());l.push(e)}});d();a.isLocked()&&(m.find(".timeslider-play-pause-button-overlay").show(),
m.find("."+f).effect("pulsate",{times:10},1E3),setTimeout(function(){m.find(".timeslider-play-pause-button-overlay").hide()},1E4));break;case "position":o||n("option","value",a.getEventCommand(a.getCurrentPosition()).getTimestamp())}};this.appendTo=m.appendTo.bind(m);this.hide=m.hide.bind(m);this.show=m.show.bind(m)}})();
(function(){WoSec.MixinObservable=function(){var b=[];this.registerObserver=function(f){if(typeof f.refresh!=="function")throw Error("Observer has to support refresh()-Method");b.push(f);return this};this.notifyObservers=function(){var f=Array.prototype.slice.call(arguments);b.forEach(function(b){b.refresh.apply(b,f)});return this}}})();
(function(){var b=WoSec.MixinObservable,f=["Reset","Starting","Started","Finished","TransferingData"];WoSec.newTask=function j(i,g,h){var a=Object.create(WoSec.baseObject);b.call(a);var e="Reset",d=[];a.constructor=j;a.getID=function(){return i};a.getWorkflow=function(){return h};a.getCorrespondingTask=function(){return typeof g=="string"&&g!=""?h.getTaskByID(g):null};a.getState=function(){return e};a.getInformation=function(){return d};a.addInformation=function(a){d.push(a);this.notifyObservers(this);
return this};a.setState=function(a){if(f.indexOf(a)==-1)throw Error("Unknown state ["+a+"] given");e=a;this.notifyObservers(this);return this};a.getMemento=function(){return{state:e,information:d}};a.setMemento=function(a){this.setState(a.state);d=a.information;this.notifyObservers(this);return this};return a}})();
(function(){var b=WoSec.MixinObservable;WoSec.newTaskLane=function c(j,i){var g=Object.create(WoSec.baseObject);b.call(g);g.getTasks=function(){var b=[];j.forEach(function(a,c){b[c]=i.getTaskByID(a)});return b};g.constructor=c;g.addInformation=function(b){this.getTasks().forEach(function(a){a.addInformation(b)});this.notifyObservers();return this};return g}})();
(function(){var b=WoSec.newTask,f=WoSec.newTaskLane,c=WoSec.MixinObservable;WoSec.newWorkflow=function i(g,h,a){if(typeof g!="string")throw new TypeError("The given id is not a String");var e=Object.create(WoSec.baseObject),d={},l={};c.call(e);return WoSec.extend(e,{constructor:i,toString:function(){return"Workflow:"+this.getID()},getID:function(){return g},getTaskByID:function(a){if(!d[a]){var c;if(typeof a!="string")throw new TypeError("The given activityID is not a String");c=b(a,h[a],e);d[a]=
c;d[a].getCorrespondingTask();this.notifyObservers(this)}return d[a]},getTaskLaneByID:function(b){if(!l[b]){var c;if(typeof b!="string")throw new TypeError("The given groupID is not a String");if(!a[b])throw Error("Unknown activityGroupID["+b+"]");c=f(a[b],e);l[b]=c;this.notifyObservers(this)}return l[b]},getTaskRepositoryEntries:function(){var a=[],b;for(b in d)a.push(b);return a},getTaskLaneRepositoryEntries:function(){var a=[],b;for(b in l)a.push(b);return a}})}})();
(function(){function b(a){if(typeof a!="number")throw Error("Timestamp ["+a+"] is not a number");this.timestamp=a}function f(a,c,d){b.call(this,d);this.task=a;this.information=c;this.information.timestamp=d}function c(a,c,d){b.call(this,d);this.task=a;this.information=c||{};this.information.timestamp=d}function j(a,c,d){b.call(this,d);this.task=a;this.information=c||{};this.information.timestamp=d}function i(a,c,d){b.call(this,d);this.taskLane=a;this.information=c||{};this.information.timestamp=d}
var g=WoSec.newWorkflow,h;b.prototype=Object.create(WoSec.baseObject);b.prototype.classname="EventCommand";b.prototype.getClass=function(){return this.classname};b.prototype.execute=function(){return this};b.prototype.unwind=function(){return this};b.prototype.getTimestamp=function(){return this.timestamp};b.create=function(a){return new b(a.timestamp)};WoSec.inherit(f,b);f.prototype.classname="StartingTaskEvent";f.prototype.execute=function(){this.task.setState("Started");this.taskMemento=this.task.getMemento();
this.task.addInformation(this.information);var a=this.task.getCorrespondingTask();if(a)this.correspondingTaskMemento=a.getMemento(),a.setState("Started"),this.task.getCorrespondingTask().addInformation(this.information);return this};f.prototype.unwind=function(){this.task.setMemento(this.taskMemento);var a=this.task.getCorrespondingTask();a&&a.setMemento(this.correspondingTaskMemento);return this};f.create=function(a){return new f(h.getTaskByID(a.activityID),a.information,a.timestamp)};WoSec.inherit(c,
b);c.prototype.classname="FinishingTaskEvent";c.prototype.execute=function(){this.task.setState("Finished");this.taskMemento=this.task.getMemento();this.task.addInformation(this.information);var a=this.task.getCorrespondingTask();if(a)this.correspondingTaskMemento=a.getMemento(),a.setState("Finished"),this.task.getCorrespondingTask().addInformation(this.information);return this};c.prototype.unwind=function(){this.task.setMemento(this.taskMemento);var a=this.task.getCorrespondingTask();a&&a.setMemento(this.correspondingTaskMemento);
return this};c.create=function(a){return new c(h.getTaskByID(a.activityID),a.information,a.timestamp)};WoSec.inherit(j,b);j.prototype.classname="TransferingDataEvent";j.prototype.execute=function(){this.task.setState("TransferingData");this.taskMemento=this.task.getMemento();this.task.addInformation(this.information);var a=this.task.getCorrespondingTask();if(a)this.correspondingTaskMemento=a.getMemento(),this.task.getCorrespondingTask().addInformation(this.information);return this};j.prototype.unwind=
function(){this.task.setMemento(this.taskMemento);var a=this.task.getCorrespondingTask();a&&a.setMemento(this.correspondingTaskMemento);return this};j.create=function(a){return new j(h.getTaskByID(a.activityID),a.information,a.timestamp)};WoSec.inherit(i,b);i.prototype.classname="SpecifyingParticipantEvent";i.prototype.execute=function(){this.taskMementos=this.taskLane.getTasks().map(function(a){return a.getMemento()});this.taskLane.addInformation(this.information);return this};i.prototype.unwind=
function(){this.taskLane.getTasks().forEach(function(a,b){a.setMemento(this.taskMementos[b])});return this};i.create=function(a){return new i(h.getTaskLaneByID(a.activityGroupID),a.information,a.timestamp)};WoSec.eventCommands={usingWorkflow:function(a){if(!a instanceof g)throw new TypeError("Given argument is not a workflow ["+a+"]");h=a;return this},EventCommand:b,StartingTask:f,FinishingTask:c,TransferingData:j,SpecifyingParticipant:i}})();
(function(){var b=WoSec.eventCommands,f=b.EventCommand,c=WoSec.MixinObservable;WoSec.newEventChain=function i(g){var h=[],a=0,e=!1,d=Object.create(WoSec.baseObject);c.call(d);return WoSec.extend(d,{constructor:i,getWorkflow:function(){return g},getCurrentPosition:function(){return a},getEventCommand:function(a){return h[a]},getLength:function(){return h.length},lock:function(){e=!0;return this},unlock:function(){e=!1;return this},isLocked:function(){return e},add:function(c){c=c||[];c.forEach(function(a){if(!b[a.eventCommand])throw Error("Unknown EventCommand: "+
a.eventCommand);h.push(b.usingWorkflow(g)[a.eventCommand].create(a))});this.notifyObservers(this,"add");!this.isLocked()&&a>0&&(a++,this.notifyObservers(this,"position"));return this},seek:function(b,c){for(var d=c?-1:1,e=a;0<=e&&e<h.length;){a=e;if(b(h[e],e)===!1)break;this.notifyObservers(this,"position");e+=d}return this},forEach:h.forEach.bind(h),play:function(){if(e)return this;var a=0;this.seek(function(b){b.later(a,"execute");a+=1E3});return this},last:function(){return h[h.length-1]?h[h.length-
1]:new f(0)}})}})();
WoSec.AJAXUpdater=function(b,f,c){function j(a){g.getJSON(i,{since:b.last().getTimestamp()+1,instance:b.getWorkflow().getID()},a)}var i="UpdateController?type=Event",g=jQuery,h=0,f=f||0;j(function(a){a.length!=0&&(c.disableAnimations(b),b.add(a).seek(function(a){return a.getTimestamp()<=f&&a.execute()}),c.enableAnimations(b),b.play())});var a=function(c){c.length!=0&&b.add(c).play();setTimeout(j,5E3,a)};setTimeout(j,5E3,a);g("body").ajaxError(function(){h++;h>=3?alert("Verbindung zum Server verloren!"):setTimeout(j,
5E3,a)})};
