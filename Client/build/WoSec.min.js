var WoSec={baseObject:{later:function(c,d){var b=this,g=Array.prototype.slice.apply(arguments,[2]);typeof d==="string"&&(d=b[d]);setTimeout(function(){d.apply(b,g)},c);return b}},inherit:function(c,d){var b=Object.create(d.prototype);b.constructor=c;c.prototype=b},extend:function(c,d){for(var b in d)d.hasOwnProperty(b)&&(c[b]=d[b]);return c}};(function(){var c=jQuery;WoSec.SVG=function(d){this.$svg=c("#"+d)}})();
(function(){function c(c,f){return c.find("svg rect").filter(function(){return b(this).attr("bpmn:activity-id")==f})}function d(c,f){return c.find("svg circle").filter(function(){return b(this).attr("bpmn:activity-id")==f})}var b=jQuery,g={};WoSec.SVG.prototype.getTaskRectangle=function(b){g[b]||(g[b]=this.newTaskRectangle(b));return g[b]};WoSec.SVG.prototype.newTaskRectangle=function(g){var f=this.$svg,e=c(f,g);e.length||(e=d(f,g));if(e.length==0)throw Error("No rectangles/circles with activityID:["+
g+"] found");var a=Object.create(WoSec.baseObject),h=!0;a.disableAnimations=function(){h=!1;return this};a.enableAnimations=function(){h=!0;return this};a.scrollTo=function(){var a=this.getPosition(),b=a.x-f.parent().width()/2,a=a.y-f.parent().height()/2,c=f.scrollLeft(),e=f.scrollTop();if(Math.abs(b-c)>100||Math.abs(a-e)>100)f.animate({scrollLeft:b},100),f.animate({scrollTop:a},100);return this};a.refresh=function(a){switch(a.getState()){case "Reset":this.reset();break;case "Started":this.markObtrusive();
this.scrollTo();h&&this.highlight();break;case "Finished":this.markUnobtrusive(),this.scrollTo()}};a.getPosition=function(){return{x:parseInt(b(e[0]).attr("x")),y:parseInt(b(e[0]).attr("y")),width:parseInt(b(e[0]).attr("width")),height:parseInt(b(e[0]).attr("height")),getCenter:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}};var j=f.find("svg text").filter(function(){var c=a.getPosition();return Math.abs(parseInt(b(this).attr("x"))-c.x)<c.width&&Math.abs(parseInt(b(this).attr("y"))-
c.y)<c.height});a.highlight=function(){e.each(function(){b(this).effect("pulsate",{times:3},1E3)});return this};a.markObtrusive=function(){e.each(function(){var a=b("#rect-obtrusive").css("color");b(this).attr("fill",a);b(this).css("fill",a)});return this};a.markUnobtrusive=function(){e.each(function(){var a=b("#rect-unobtrusive").css("color");b(this).attr("fill",a);b(this).css("fill",a)});return this};a.reset=function(){e.each(function(){var a=b("#rect-reset").css("color");b(this).attr("fill",a);
b(this).css("fill",a)});return this};a.registerOnClick=function(a){b(e[0]).click(a);j.each(function(){b(this).click(a)});return this};a.registerOnHover=function(a){b(e[0]).hover(a);j.each(function(){b(this).hover(a)});return this};return a}})();
(function(){function c(b,c){return b.find("svg rect").filter(function(){return d(this).attr("bpmn:pool-id")==c})}var d=jQuery;WoSec.SVG.prototype.newTaskLaneRectangle=function(b){var g=c(this.$svg,b),b=Object.create(WoSec.baseObject),i=!0;b.disableAnimations=function(){i=!1;return this};b.enableAnimations=function(){i=!0;return this};b.highlight=function(){g.each(function(){d(this).effect("pulsate",{times:1},1E3)})};b.refresh=function(){i&&this.highlight()};return b}})();
(function(){var c,d,b=jQuery;c=25.5;d=33;var g;WoSec.SVG.prototype.newDataAnimation=function(i,f,e){function a(a){a.x-=c/2;a.y-=d/2;return a}var f=a(f),e=a(e),h=Object.create(WoSec.baseObject),j=this.$svg;g||(g=document.createElementNS("http://www.w3.org/2000/svg","image"),g.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","media/images/fileicon.png"),g.setAttribute("width",c),g.setAttribute("height",d));var m=g.cloneNode(!0);m.setAttribute("id",i);j.find("svg")[0].appendChild(m);var k=
b("#"+i);k.hide();k.attr("x",f.x);k.attr("y",f.y);var l=!0;h.disableAnimations=function(){l=!1;return this};h.enableAnimations=function(){l=!0;return this};h.show=function(){k.show();k.animate({svgY:e.y},1E3,function(){k.hide();k.attr("y",f.y)});return this};h.refresh=function(a){switch(a.getState()){case "TransferingData":l&&this.show()}};return h}})();
(function(){var c=WoSec.SVG;WoSec.HTMLGUI=function(d){var b=new c("instancesvg"),g=[],i=[],f=[];this.disableAnimations=function(){g.forEach(function(a){a.disableAnimations()});return this};this.enableAnimations=function(){g.forEach(function(a){a.enableAnimations()});return this};this.refresh=function(a){for(var c=a.getTaskRepositoryEntries(),e,d=c.length-1;d>=0;d--)if(e=c[d],!(i.indexOf(e)>-1)){var k=a.getTaskByID(e),l=b.newTaskRectangle(e);k.registerObserver(l);var n;k.getCorrespondingTask()&&(n=
b.newDataAnimation(e,l.getPosition().getCenter(),b.getTaskRectangle(k.getCorrespondingTask().getID()).getPosition().getCenter()),k.registerObserver(n));e=this.newInfobox(l.getPosition());k.registerObserver(e);l.registerOnHover(e.show);e.registerOnHover(e.pin,e.unpin);e.appendTo("#infoboxes");g.push(l);n&&g.push(n)}i=c;c=a.getTaskLaneRepositoryEntries();for(d=c.length-1;d>=0;d--)k=c[d],f.indexOf(k)>-1||(l=b.newTaskLaneRectangle(k),a.getTaskLaneByID(k).registerObserver(l),g.push(l));f=c;return this};
var e=this.newTimeSlider(this,d);d.registerObserver(e);d.getWorkflow().registerObserver(this)}})();
(function(){var c=jQuery,d,b,g;WoSec.HTMLGUI.prototype.newInfobox=function(i){d||(d=c('<div class="infobox"></div>').hide());var f=d.clone(),e=!0;f.css("top",i.y+i.height);f.css("left",i.x+i.width);var a=!1,h=!1,j=Object.create(WoSec.baseObject);return WoSec.extend(j,{refresh:function(a){this.setContent(a.getInformation())},show:function(){!a&&!e&&(f.slideToggle("slow"),a=!0,j.later(3E3,"hide"));return this},hide:function(){a&&!h&&(f.slideToggle("slow"),a=!1);return this},pin:function(){h=!0;j.show();
return this},unpin:function(){h=!1;j.hide();return this},setContent:function(a){f.html("");a.forEach(function(a){b||(b=c('<div class="infobox-entry"><span class="infobox-entry-header"><span class="infobox-entry-time"></span><span class="infobox-entry-execUser"></span></span><div class="infobox-entry-content"><span class="infobox-entry-evokUser"></span><span class="infobox-entry-provider"></span><span class="infobox-entry-data"></span><ul class="infobox-entry-attachments"></ul><span class="infobox-entry-usageReason"></span></div></div>'));
var d=b.clone();d.find(".infobox-entry-time").text(a.timestamp);a.participants&&(d.find(".infobox-entry-execUser").text(a.participants.execUser),d.find(".infobox-entry-evokUser").text(a.participants.evokUser),d.find(".infobox-entry-provider").text(a.participants.provider),e=!1);d.find(".infobox-entry-data").text(a.data);if(a.attachments){var h=d.find(".infobox-entry-attachments");a.attachments.forEach(function(a){g||(g=c('<li class="infobox-attachment-entry"><span class="infobox-attachment-entry-name"></span><a></a></li>'));
var b=g.clone();b.find(".infobox-attachment-entry-name").text(a.name);b.find("a").attr("href",a.link).text(a.type);h.append(b)});e=!1}d.find(".infobox-entry-usageReason").text(a.usageReason);f.append(d)});return this},registerOnClick:function(a){f.click(a);return this},registerOnHover:function(a,b){f.hover(a,b);return this},appendTo:function(a){f.appendTo(a);return this}})}})();
(function(){var c=jQuery,d;WoSec.HTMLGUI.prototype.newTimeSlider=function(b,g){c("#timeslider-play-button").click(function(){b.enableAnimations();g.unlock().play()});var i=[],f=c("#timeslider").slider({slide:function(c,a){var d=f.slider("option","value"),j=a.value<d,m;i.forEach(function(b){if(b.timestamp<=a.value)m=b.eventCommand});b.disableAnimations();g.lock().seek(function(a){j?a.unwind():a.execute();if(a==m)return!1},j)}});return{adjustSize:function(b){var a,h,g=f.slider("option","min"),m=f.slider("option",
"max"),k=!1;b.forEach(function(b,e){if(!i[e]){var g={};g.eventCommand=b;g.timestamp=b.getTimestamp();d||(d=c('<a class="timeslider-entry"></a>'));g.entry=d.clone().appendTo("#timeslider");g.entry.addClass("timeslider-entry-"+b.getClass());i.push(g)}g=b.getTimestamp();if(!a||g<a)a=g;if(!h||g>h)h=g;a&&(f.slider("option","min",a),k=!0);h&&(f.slider("option","max",h),k=!0)});a==g&&h==m&&(k=!1);if(k){var l=h-a;i.forEach(function(a){rightPercent=(h-a.timestamp)/l*100;a.entry.css("left",100-rightPercent+
"%")})}return this},refresh:function(b){b.getLength()!=i.length&&(this.adjustSize(b),b.isLocked()&&(c("#timeslider-play-button-overlay").show(),c("#timeslider-play-button").effect("pulsate",{times:10},1E3),setTimeout(function(){c("#timeslider-play-button-overlay").hide()},1E4)));f.slider("option","value",b.getEventCommand(b.getCurrentPosition()).getTimestamp());return this}}}})();
(function(){WoSec.MixinObservable=function(){var c=[];this.registerObserver=function(d){if(typeof d.refresh!=="function")throw Error("Observer has to support refresh()-Method");c.push(d);return this};this.notifyObservers=function(){var d=Array.prototype.slice.call(arguments);c.forEach(function(b){b.refresh.apply(b,d)});return this}}})()(function(){var c=WoSec.MixinObservable,d=["Reset","Starting","Started","Finished","TransferingData"];WoSec.newTask=function g(i,f,e){var a=Object.create(WoSec.baseObject);
c.call(a);var h="Reset",j=[];a.constructor=g;a.getID=function(){return i};a.getCorrespondingTask=function(){return typeof f=="string"&&f!=""?e.getTaskByID(f):null};a.getState=function(){return h};a.getInformation=function(){return j};a.addInformation=function(a){j.push(a);this.notifyObservers(this);return this};a.setState=function(a){if(d.indexOf(a)==-1)throw Error("Unknown state ["+a+"] given");h=a;this.notifyObservers(this);return this};return a}}());
(function(){var c=WoSec.MixinObservable;WoSec.newTaskLane=function b(g,i){var f=Object.create(WoSec.baseObject);c.call(f);var e=function(){var a=[];g.forEach(function(b,c){a[c]=i.getTaskByID(b)});return a};f.constructor=b;f.addInformation=function(a){e().forEach(function(b){b.addInformation(a)});this.notifyObservers();return this};return f}})();
(function(){var c=WoSec.newTask,d=WoSec.newTaskLane,b=WoSec.MixinObservable;WoSec.newWorkflow=function i(f,e,a){if(typeof f!="string")throw new TypeError("The given instanceID is not a String");var h=Object.create(WoSec.baseObject),j={},m={};b.call(h);return WoSec.extend(h,{constructor:i,toString:function(){return"Workflow:"+this.getInstanceID()},getInstanceID:function(){return f},getTaskByID:function(a){if(!j[a]){var b;if(typeof a!="string")throw new TypeError("The given activityID is not a String");
b=c(a,e[a],h);j[a]=b;j[a].getCorrespondingTask();this.notifyObservers(this)}return j[a]},getTaskLaneByID:function(b){if(!m[b]){var c;if(typeof b!="string")throw new TypeError("The given groupID is not a String");if(!a[b])throw Error("Unknown activityGroupID["+b+"]");c=d(a[b],h);m[b]=c;this.notifyObservers(this)}return m[b]},getTaskRepositoryEntries:function(){var a=[],b;for(b in j)a.push(b);return a},getTaskLaneRepositoryEntries:function(){var a=[],b;for(b in m)a.push(b);return a}})}})();
(function(){function c(a){if(typeof a!="number")throw Error("Timestamp ["+a+"] is not a number");this.timestamp=a}function d(a,b){c.call(this,b);this.task=a}function b(a,b,d){c.call(this,d);this.task=a;this.information=b||{};this.information.timestamp=d}function g(a,b,d){c.call(this,d);this.task=a;this.information=b||{};this.information.timestamp=d}function i(a,b,d){c.call(this,d);this.taskLane=a;this.information=b||{};this.information.timestamp=d}var f=WoSec.newWorkflow,e;c.prototype=Object.create(WoSec.baseObject);
c.prototype.classname="EventCommand";c.prototype.getClass=function(){return this.classname};c.prototype.execute=function(){return this};c.prototype.unwind=function(){return this};c.prototype.getTimestamp=function(){return this.timestamp};c.create=function(a){return new c(a.timestamp)};WoSec.inherit(d,c);d.prototype.classname="StartingTaskEvent";d.prototype.execute=function(){this.task.setState("Started");this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setState("Started");return this};
d.prototype.unwind=function(){this.task.setState("Reset");this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setState("Reset");return this};d.create=function(a){return new d(e.getTaskByID(a.activityID),a.timestamp)};WoSec.inherit(b,c);b.prototype.classname="FinishingTaskEvent";b.prototype.execute=function(){this.task.setState("Finished");this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setState("Finished");this.task.addInformation(this.information);this.task.getCorrespondingTask()&&
this.task.getCorrespondingTask().addInformation(this.information);return this};b.prototype.unwind=function(){this.task.setState("Started");this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setState("Started");return this};b.create=function(a){return new b(e.getTaskByID(a.activityID),a.information,a.timestamp)};WoSec.inherit(g,c);g.prototype.classname="TransferingDataEvent";g.prototype.execute=function(){this.task.setState("TransferingData");return this};g.create=function(a){return new g(e.getTaskByID(a.activityID),
a.information,a.timestamp)};WoSec.inherit(i,c);i.prototype.classname="SpecifyingParticipantEvent";i.prototype.execute=function(){this.taskLane.addInformation(this.information);return this};i.create=function(a){return new i(e.getTaskLaneByID(a.activityGroupID),a.information,a.timestamp)};WoSec.eventCommands={usingWorkflow:function(a){if(!a instanceof f)throw new TypeError("Given argument is not a workflow ["+a+"]");e=a;return this},EventCommand:c,StartingTask:d,FinishingTask:b,TransferingData:g,SpecifyingParticipant:i}})();
(function(){var c=WoSec.eventCommands,d=c.EventCommand,b=WoSec.MixinObservable;WoSec.newEventChain=function i(f){var e=[],a=0,h=!1,j=Object.create(WoSec.baseObject);b.call(j);return WoSec.extend(j,{constructor:i,getWorkflow:function(){return f},getCurrentPosition:function(){return a},getEventCommand:function(a){return e[a]},getLength:function(){return e.length},lock:function(){h=!0;return this},unlock:function(){h=!1;return this},isLocked:function(){return h},add:function(a){a=a||[];a.forEach(function(a){if(!c[a.eventCommand])throw Error("Unknown EventCommand: "+
a.eventCommand);e.push(c.usingWorkflow(f)[a.eventCommand].create(a))});e.sort(function(){});this.notifyObservers(this);return this},seek:function(b,c){var d=c?-1:1,f=a;for(f==e.length&&f--;0<=f&&f<e.length;){a=f;if(b(e[f],f)===!1)break;f+=d}this.notifyObservers(this);return this},forEach:e.forEach.bind(e),play:function(){if(h)return this;var b=0;this.seek(function(a){a.later(b,"execute");b+=1E3});setTimeout(function(){a=e.length},b);return this},last:function(){return e[e.length-1]?e[e.length-1]:
new d(0)}})}})();
WoSec.AJAXUpdater=function(c){(function(c,b,g){g([{timestamp:1314373858,eventCommand:"FinishingTask",information:{},eventType:"humanActivityExecuted",activityID:"__fX4gedbEd-f6JWMxJDGcQ"},{timestamp:1314373863,eventCommand:"FinishingTask",information:{},eventType:"eventActivityExecuted",activityID:"_ggEwYYBxEd-3VeNHLWdQXA"},{timestamp:1314373864,eventCommand:"SpecifyingParticipant",information:{},eventType:"HumanTaskExecutorSelected",activityGroupID:"_7kTKEOdbEd-f6JWMxJDGcQ"},{timestamp:1314373864,eventCommand:"SpecifyingParticipant",
information:{participants:{provider:"DB01"}},eventType:"WSProviderSelected",activityGroupID:"_1UFV4ItpEd-U-Z7QjvIBEA"},{timestamp:1314373865,eventCommand:"TransferingData",information:{data:"UserID: _sDfw47sd33saeF",participants:{provider:"DB01",evokUser:"Alice",execUser:"Ich"},attachments:[{link:"http://somewhereIbelong",name:"Das ist ein Anhang!",type:"Ein Link der nirgends hinf\u00fchrt..."}],usageReason:"wie bestellt"},eventType:"DataTransferredToWS",activityID:"_P2HHwNq2Ed-AhcDaNoYiNA"},{timestamp:1314373865,
eventCommand:"StartingTask",information:{},eventType:"startActivityExecution",activityID:"_P2HHwNq2Ed-AhcDaNoYiNA"},{timestamp:1314373866,eventCommand:"TransferingData",information:{data:"",participants:{provider:"DB01"},usageReason:"an die Datenbank geschickt, weil deshalb",attachments:[{link:"http://blabla",name:"Anschreiben",type:"Word-Dokument"},{link:"http://blablub",name:"Ausschreibung",type:"PDF-Datei"}]},eventType:"DataTransferredFromWS",activityID:"_mJVSMNq2Ed-AhcDaNoYiNA"},{timestamp:1314373867,
eventCommand:"FinishingTask",information:{participants:{provider:"DB01"}},eventType:"WSActivityExecuted",activityID:"_P2HHwNq2Ed-AhcDaNoYiNA"}])})("UpdateController?type=Event",{since:c.last().getTimestamp(),instance:c.getWorkflow().getInstanceID()},function(d){c.add(d).play()})};
