var WoSec={baseObject:{later:function(c,d){var b=this,j=Array.prototype.slice.apply(arguments,[2]);typeof d==="string"&&(d=b[d]);setTimeout(function(){d.apply(b,j)},c);return b}},inherit:function(c,d){var b=Object.create(d.prototype);b.constructor=c;c.prototype=b},extend:function(c,d){for(var b in d)d.hasOwnProperty(b)&&(c[b]=d[b]);return c}};(function(){var c=jQuery;WoSec.SVG=function(d){this.$svg=c("#"+d)}})();
(function(){function c(c,e){return c.find("svg rect").filter(function(){return b(this).attr("bpmn:activity-id")==e})}function d(c,e){return c.find("svg circle").filter(function(){return b(this).attr("bpmn:activity-id")==e})}var b=jQuery,j={};WoSec.SVG.prototype.getTaskRectangle=function(b){j[b]||(j[b]=this.newTaskRectangle(b));return j[b]};WoSec.SVG.prototype.newTaskRectangle=function(i){var e=this.$svg,g=c(e,i);g.length||(g=d(e,i));if(g.length==0)throw Error("No rectangles/circles with activityID:["+
i+"] found");var a=Object.create(WoSec.baseObject),f=!0;a.disableAnimations=function(){f=!1;return this};a.enableAnimations=function(){f=!0;return this};a.scrollTo=function(){var a=this.getPosition(),k=a.x-e.parent().width()/2,a=a.y-e.parent().height()/2,b=e.scrollLeft(),c=e.scrollTop();if(Math.abs(k-b)>100||Math.abs(a-c)>100)e.animate({scrollLeft:k},100),e.animate({scrollTop:a},100);return this};a.refresh=function(a){switch(a.getState()){case "Reset":this.reset();break;case "Started":this.markObtrusive();
this.scrollTo();f&&this.highlight();break;case "Finished":this.markUnobtrusive(),this.scrollTo()}};a.getPosition=function(){return{x:parseInt(b(g[0]).attr("x")),y:parseInt(b(g[0]).attr("y")),width:parseInt(b(g[0]).attr("width")),height:parseInt(b(g[0]).attr("height")),getCenter:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}};var h=e.find("svg text").filter(function(){var l=a.getPosition();return Math.abs(parseInt(b(this).attr("x"))-l.x)<l.width&&Math.abs(parseInt(b(this).attr("y"))-
l.y)<l.height});a.highlight=function(){g.each(function(){b(this).effect("pulsate",{times:3},1E3)});return this};a.markObtrusive=function(){g.each(function(){var a=b("#rect-obtrusive").css("color");b(this).attr("fill",a);b(this).css("fill",a)});return this};a.markUnobtrusive=function(){g.each(function(){var a=b("#rect-unobtrusive").css("color");b(this).attr("fill",a);b(this).css("fill",a)});return this};a.reset=function(){g.each(function(){var a=b("#rect-reset").css("color");b(this).attr("fill",a);
b(this).css("fill",a)});return this};a.registerOnClick=function(a){b(g[0]).click(a);h.each(function(){b(this).click(a)});return this};a.registerOnHover=function(a){b(g[0]).hover(a);h.each(function(){b(this).hover(a)});return this};return a}})();
(function(){function c(b,c){return b.find("svg rect").filter(function(){return d(this).attr("bpmn:pool-id")==c})}var d=jQuery;WoSec.SVG.prototype.newTaskLaneRectangle=function(b){var j=c(this.$svg,b),b=Object.create(WoSec.baseObject),i=!0;b.disableAnimations=function(){i=!1;return this};b.enableAnimations=function(){i=!0;return this};b.highlight=function(){j.each(function(){d(this).effect("pulsate",{times:1},1E3)})};b.refresh=function(){i&&this.highlight()};return b}})();
(function(){var c,d,b=jQuery;c=25.5;d=33;var j;WoSec.SVG.prototype.newDataAnimation=function(i,e,g){function a(a){a.x-=c/2;a.y-=d/2;return a}var e=a(e),g=a(g),f=Object.create(WoSec.baseObject),h=this.$svg;j||(j=document.createElementNS("http://www.w3.org/2000/svg","image"),j.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","media/images/fileicon.png"),j.setAttribute("width",c),j.setAttribute("height",d));var l=j.cloneNode(!0);l.setAttribute("id",i);h.find("svg")[0].appendChild(l);var k=
b("#"+i);k.hide();k.attr("x",e.x);k.attr("y",e.y);var o=!0;f.disableAnimations=function(){o=!1;return this};f.enableAnimations=function(){o=!0;return this};f.show=function(){k.show();k.animate({svgY:g.y},1E3,function(){k.hide();k.attr("y",e.y)});return this};f.refresh=function(a){switch(a.getState()){case "TransferingData":o&&this.show()}};return f}})();
(function(){var c=jQuery,d=WoSec.SVG;WoSec.HTMLGUI=function(b){var j=this,i={},e={},g={},a={},f={},h=[];this.refresh=function(b){for(var k=b.getID(),d=b.getTaskRepositoryEntries(),f,h=d.length-1;h>=0;h--)if(f=d[h],!(g[k].indexOf(f)>-1)){var m=b.getTaskByID(f),n=i[k].newTaskRectangle(f);m.registerObserver(n);var p;m.getCorrespondingTask()&&(p=i[k].newDataAnimation(f,n.getPosition().getCenter(),i[k].getTaskRectangle(m.getCorrespondingTask().getID()).getPosition().getCenter()),m.registerObserver(p));
f=j.newInfobox(n.getPosition());m.registerObserver(f);n.registerOnHover(f.show);f.appendTo(c("#"+k).find(".infoboxes"));e[k].push(n);p&&e[k].push(p)}g[k]=d;k=b.getID();d=b.getTaskLaneRepositoryEntries();for(m=d.length-1;m>=0;m--)h=d[m],a[k].indexOf(h)>-1||(n=i[k].newTaskLaneRectangle(h),b.getTaskLaneByID(h).registerObserver(n),e[k].push(n));a[k]=d;return this};b.forEach(function(a){var b=a.getWorkflow(),c=b.getID();h.push(c);f[c]=j.newTimeSlider(j,a);a.registerObserver(f[c]);b.registerObserver(j)});
c(".svg").each(function(){var b=c(this).attr("id");if(h.indexOf(b)===-1)throw Error("Unknown workflowID["+b+"]");i[b]=new d(b);e[b]=[];g[b]=[];a[b]=[]});this.disableAnimations=function(){e.forEach(function(a){a.disableAnimations()});return this};this.enableAnimations=function(){e.forEach(function(a){a.enableAnimations()});return this}}})();
(function(){var c=jQuery,d,b,j;WoSec.HTMLGUI.prototype.newInfobox=function(i){d||(d=c("<div class=\"infobox\"><span class='infobox-pin-button'>#</span></div>").hide());var e=d.clone(),g=!0;e.css("top",i.y+i.height);e.css("left",i.x+i.width);var a=!1,f=!1;e.find(".infobox-pin-button").click(function(){f?h.unpin():h.pin()});var h=Object.create(WoSec.baseObject);return WoSec.extend(h,{refresh:function(a){this.setContent(a.getInformation())},show:function(){!a&&!g&&(e.slideToggle("slow"),a=!0,h.later(7E3,
"hide"));return this},hide:function(){a&&!f&&(e.slideToggle("slow"),a=!1);return this},pin:function(){f=!0;h.show();return this},unpin:function(){f=!1;h.hide();return this},setContent:function(a){e.find(".infobox-entry").remove();console.log(a);a.forEach(function(a){b||(b=c('<div class="infobox-entry"><span class="infobox-entry-header"><span class="infobox-entry-time"></span><span class="infobox-entry-execUser"></span></span><div class="infobox-entry-content"><span class="infobox-entry-evokUser"></span><span class="infobox-entry-provider"></span><span class="infobox-entry-data"></span><ul class="infobox-entry-attachments"></ul><span class="infobox-entry-usageReason"></span></div></div>'));
var f=b.clone(),d=new Date(a.timestamp*1E3);f.find(".infobox-entry-time").text(d.getDate()+"."+d.getMonth()+"."+d.getFullYear());a.participants&&(f.find(".infobox-entry-execUser").text(a.participants.execUser),f.find(".infobox-entry-evokUser").text(a.participants.evokUser),f.find(".infobox-entry-provider").text(a.participants.provider),g=!1);f.find(".infobox-entry-data").text(a.data);if(a.attachments){var h=f.find(".infobox-entry-attachments");a.attachments.forEach(function(a){j||(j=c('<li class="infobox-attachment-entry"><span class="infobox-attachment-entry-name"></span><a></a></li>'));
var b=j.clone();b.find(".infobox-attachment-entry-name").text(a.name);b.find("a").attr("href",a.link).text(a.type);h.append(b)});g=!1}f.find(".infobox-entry-usageReason").text(a.usageReason);e.append(f)});return this},registerOnClick:function(a){e.click(a);return this},registerOnHover:function(a,b){e.hover(a,b);return this},appendTo:function(a){e.appendTo(a);return this}})}})();
(function(){var c=jQuery,d;WoSec.HTMLGUI.prototype.newTimeSlider=function(b,j){c("#timeslider-play-button").click(function(){b.enableAnimations();j.unlock().play()});var i=[],e=c("#timeslider").slider({slide:function(c,a){var f=e.slider("option","value"),d=a.value<f,l;i.forEach(function(b){if(b.timestamp<=a.value)l=b.eventCommand});b.disableAnimations();j.lock().seek(function(a){d?a.unwind():a.execute();if(a==l)return!1},d)}});return{adjustSize:function(b){var a,f,h=e.slider("option","min"),j=e.slider("option",
"max"),k=!1;b.forEach(function(b,g){if(!i[g]){var h={};h.eventCommand=b;h.timestamp=b.getTimestamp();d||(d=c('<a class="timeslider-entry"></a>'));h.entry=d.clone().appendTo("#timeslider");h.entry.addClass("timeslider-entry-"+b.getClass());i.push(h)}h=b.getTimestamp();if(!a||h<a)a=h;if(!f||h>f)f=h;a&&(e.slider("option","min",a),k=!0);f&&(e.slider("option","max",f),k=!0)});a==h&&f==j&&(k=!1);if(k){var o=f-a;i.forEach(function(a){rightPercent=(f-a.timestamp)/o*100;a.entry.css("left",100-rightPercent+
"%")})}return this},refresh:function(b){b.getLength()!=i.length&&(this.adjustSize(b),b.isLocked()&&(c("#timeslider-play-button-overlay").show(),c("#timeslider-play-button").effect("pulsate",{times:10},1E3),setTimeout(function(){c("#timeslider-play-button-overlay").hide()},1E4)));e.slider("option","value",b.getEventCommand(b.getCurrentPosition()).getTimestamp());return this}}}})();
(function(){WoSec.MixinObservable=function(){var c=[];this.registerObserver=function(d){if(typeof d.refresh!=="function")throw Error("Observer has to support refresh()-Method");c.push(d);return this};this.notifyObservers=function(){var d=Array.prototype.slice.call(arguments);c.forEach(function(b){b.refresh.apply(b,d)});return this}}})()(function(){var c=WoSec.MixinObservable,d=["Reset","Starting","Started","Finished","TransferingData"];WoSec.newTask=function j(i,e,g){var a=Object.create(WoSec.baseObject);
c.call(a);var f="Reset",h=[];a.constructor=j;a.getID=function(){return i};a.getCorrespondingTask=function(){return typeof e=="string"&&e!=""?g.getTaskByID(e):null};a.getState=function(){return f};a.getInformation=function(){return h};a.addInformation=function(a){h.push(a);this.notifyObservers(this);return this};a.setState=function(a){if(d.indexOf(a)==-1)throw Error("Unknown state ["+a+"] given");f=a;this.notifyObservers(this);return this};return a}}());
(function(){var c=WoSec.MixinObservable;WoSec.newTaskLane=function b(j,i){var e=Object.create(WoSec.baseObject);c.call(e);var g=function(){var a=[];j.forEach(function(b,c){a[c]=i.getTaskByID(b)});return a};e.constructor=b;e.addInformation=function(a){g().forEach(function(b){b.addInformation(a)});this.notifyObservers();return this};return e}})();
(function(){var c=WoSec.newTask,d=WoSec.newTaskLane,b=WoSec.MixinObservable;WoSec.newWorkflow=function i(e,g,a){if(typeof e!="string")throw new TypeError("The given id is not a String");var f=Object.create(WoSec.baseObject),h={},l={};b.call(f);return WoSec.extend(f,{constructor:i,toString:function(){return"Workflow:"+this.getID()},getID:function(){return e},getTaskByID:function(a){if(!h[a]){var b;if(typeof a!="string")throw new TypeError("The given activityID is not a String");b=c(a,g[a],f);h[a]=
b;h[a].getCorrespondingTask();this.notifyObservers(this)}return h[a]},getTaskLaneByID:function(b){if(!l[b]){var c;if(typeof b!="string")throw new TypeError("The given groupID is not a String");if(!a[b])throw Error("Unknown activityGroupID["+b+"]");c=d(a[b],f);l[b]=c;this.notifyObservers(this)}return l[b]},getTaskRepositoryEntries:function(){var a=[],b;for(b in h)a.push(b);return a},getTaskLaneRepositoryEntries:function(){var a=[],b;for(b in l)a.push(b);return a}})}})();
(function(){function c(a){if(typeof a!="number")throw Error("Timestamp ["+a+"] is not a number");this.timestamp=a}function d(a,b,d){c.call(this,d);this.task=a;this.information=b;this.information.timestamp=d}function b(a,b,d){c.call(this,d);this.task=a;this.information=b||{};this.information.timestamp=d}function j(a,b,d){c.call(this,d);this.task=a;this.information=b||{};this.information.timestamp=d}function i(a,b,d){c.call(this,d);this.taskLane=a;this.information=b||{};this.information.timestamp=d}
var e=WoSec.newWorkflow,g;c.prototype=Object.create(WoSec.baseObject);c.prototype.classname="EventCommand";c.prototype.getClass=function(){return this.classname};c.prototype.execute=function(){return this};c.prototype.unwind=function(){return this};c.prototype.getTimestamp=function(){return this.timestamp};c.create=function(a){return new c(a.timestamp)};WoSec.inherit(d,c);d.prototype.classname="StartingTaskEvent";d.prototype.execute=function(){this.task.setState("Started");this.task.getCorrespondingTask()&&
this.task.getCorrespondingTask().setState("Started");this.task.addInformation(this.information);this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().addInformation(this.information);return this};d.prototype.unwind=function(){this.task.setState("Reset");this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setState("Reset");return this};d.create=function(a){return new d(g.getTaskByID(a.activityID),a.information,a.timestamp)};WoSec.inherit(b,c);b.prototype.classname="FinishingTaskEvent";
b.prototype.execute=function(){this.task.setState("Finished");this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setState("Finished");this.task.addInformation(this.information);this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().addInformation(this.information);return this};b.prototype.unwind=function(){this.task.setState("Started");this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setState("Started");return this};b.create=function(a){return new b(g.getTaskByID(a.activityID),
a.information,a.timestamp)};WoSec.inherit(j,c);j.prototype.classname="TransferingDataEvent";j.prototype.execute=function(){this.task.setState("TransferingData");this.task.addInformation(this.information);this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().addInformation(this.information);return this};j.create=function(a){return new j(g.getTaskByID(a.activityID),a.information,a.timestamp)};WoSec.inherit(i,c);i.prototype.classname="SpecifyingParticipantEvent";i.prototype.execute=function(){this.taskLane.addInformation(this.information);
return this};i.create=function(a){return new i(g.getTaskLaneByID(a.activityGroupID),a.information,a.timestamp)};WoSec.eventCommands={usingWorkflow:function(a){if(!a instanceof e)throw new TypeError("Given argument is not a workflow ["+a+"]");g=a;return this},EventCommand:c,StartingTask:d,FinishingTask:b,TransferingData:j,SpecifyingParticipant:i}})();
(function(){var c=WoSec.eventCommands,d=c.EventCommand,b=WoSec.MixinObservable;WoSec.newEventChain=function i(e){var g=[],a=0,f=!1,h=Object.create(WoSec.baseObject);b.call(h);return WoSec.extend(h,{constructor:i,getWorkflow:function(){return e},getCurrentPosition:function(){return a},getEventCommand:function(a){return g[a]},getLength:function(){return g.length},lock:function(){f=!0;return this},unlock:function(){f=!1;return this},isLocked:function(){return f},add:function(a){a=a||[];a.forEach(function(a){if(!c[a.eventCommand])throw Error("Unknown EventCommand: "+
a.eventCommand);g.push(c.usingWorkflow(e)[a.eventCommand].create(a))});g.sort(function(){});this.notifyObservers(this);return this},seek:function(b,c){var d=c?-1:1,e=a;for(e==g.length&&e--;0<=e&&e<g.length;){a=e;if(b(g[e],e)===!1)break;e+=d}this.notifyObservers(this);return this},forEach:g.forEach.bind(g),play:function(){if(f)return this;var b=0;this.seek(function(a){a.later(b,"execute");b+=600});setTimeout(function(){a=g.length},b);return this},last:function(){return g[g.length-1]?g[g.length-1]:
new d(0)}})}})();
WoSec.AJAXUpdater=function(c){(function(c,b,j){j([{timestamp:1314373858,eventCommand:"FinishingTask",information:{},eventType:"humanActivityExecuted",activityID:"__fX4gedbEd-f6JWMxJDGcQ"},{timestamp:1314373863,eventCommand:"FinishingTask",information:{},eventType:"eventActivityExecuted",activityID:"_ggEwYYBxEd-3VeNHLWdQXA"},{timestamp:1314373864,eventCommand:"SpecifyingParticipant",information:{},eventType:"HumanTaskExecutorSelected",activityGroupID:"_7kTKEOdbEd-f6JWMxJDGcQ"},{timestamp:1314373864,eventCommand:"SpecifyingParticipant",
information:{participants:{provider:"DB01"}},eventType:"WSProviderSelected",activityGroupID:"_1UFV4ItpEd-U-Z7QjvIBEA"},{timestamp:1314373865,eventCommand:"TransferingData",information:{data:"Name, Adresse",participants:{provider:"DB01",evokUser:"Alice",execUser:"Ich"},attachments:[{link:"http://somewhereIbelong",name:"Das ist ein Anhang!",type:"Ein Link der nirgends hinf\u00fchrt..."}],usageReason:"wie bestellt"},eventType:"DataTransferredToWS",activityID:"_P2HHwNq2Ed-AhcDaNoYiNA"},{timestamp:1314373865,
eventCommand:"StartingTask",information:{},eventType:"startActivityExecution",activityID:"_P2HHwNq2Ed-AhcDaNoYiNA"},{timestamp:1314373866,eventCommand:"TransferingData",information:{data:"",participants:{provider:"DB01"},usageReason:"an die Datenbank geschickt, weil deshalb",attachments:[{link:"http://blabla",name:"Anschreiben",type:"Word-Dokument"},{link:"http://blablub",name:"Ausschreibung",type:"PDF-Datei"}]},eventType:"DataTransferredFromWS",activityID:"_mJVSMNq2Ed-AhcDaNoYiNA"},{timestamp:1314373867,
eventCommand:"FinishingTask",information:{participants:{provider:"DB01"}},eventType:"WSActivityExecuted",activityID:"_P2HHwNq2Ed-AhcDaNoYiNA"}])})("UpdateController?type=Event",{since:c.last().getTimestamp(),instance:c.getWorkflow().getID()},function(d){c.add(d).play()})};
